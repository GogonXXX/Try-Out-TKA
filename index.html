<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ASAS SD NEGERI YANTI ‚Äî ExamBrowser Web</title>
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#0e639c">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Arial, sans-serif; }
    body { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color: #333; line-height: 1.6; padding: 20px; min-height: 100vh; }
    .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,.2); overflow: hidden; }
    header { background: linear-gradient(135deg, #2d2d30 0%, #4a4a4f 100%); padding: 20px; border-bottom: 3px solid #0e639c; text-align: center; color: white; }
    h1 { color: #fff; font-size: 28px; margin-bottom: 4px; }
    .subtitle { color: #cccccc; font-size: 14px; font-weight: 300; }
    .content { padding: 22px; }
    .menu { display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 10px; padding: 18px; background: #f8f9fa; border-radius: 8px; border: 2px solid #e9ecef; align-items: center; }
    input[type="text"], input[type="number"], textarea { padding: 8px; border-radius: 6px; border: 2px solid #ced4da; background: white; color: #495057; font-size: 14px; transition: border-color .3s; width: 100%; }
    button { background: #0e639c; color: #fff; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; transition: all .18s; font-weight: 700; }
    .card { background: white; border-radius: 10px; padding: 18px; box-shadow: 0 4px 15px rgba(0,0,0,.08); margin-bottom: 15px; border: 2px solid #e9ecef; }
    .time { font-weight: bold; color: #e11d48; margin-bottom: 10px; font-size: 18px; text-align: center; padding: 8px; border-radius: 8px; background: #fff5f5; border: 2px solid #e11d48; }
    .panel-buttons { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px; }
    .panel-buttons button { width: 44px; height: 44px; border-radius: 8px; border: 2px solid #e6e6e6; background: white; color: #111; font-weight: 700; cursor: pointer; }
    .panel-buttons button.answered { background: #ecfdf5; border-color: #bbf7d0; color: #166534; }
    .panel-buttons button.marked { background: #fffbeb; border-color: #fde68a; color: #92400e; }
    .panel-buttons button.current { background: #eff6ff; border-color: #bfdbfe; color: #0f4aa1; }
    .score-display { font-size: 22px; font-weight: 700; text-align: center; padding: 12px; margin: 12px 0; border-radius: 8px; background: linear-gradient(135deg, #22c55e, #16a34a); color: #fff; }
    .no-select { user-select: none; -webkit-user-select: none; -ms-user-select: none; }
    .answer-btn {
  display: block;
  width: 100%;
  margin: 8px 0;
  padding: 12px;
  text-align: left;
  background: #ffffff;
  color: #000000;  /* TEKS WARNA HITAM */
  border: 2px solid #cbd5e1;
  border-radius: 8px;
  cursor: pointer;
  font-size: 16px;
}

.answer-btn:hover {
  background: #f1f5f9;
  color: #000000;  /* JAGA WARNA HITAM SAAT HOVER */
}

.answer-btn.active {
  background: #e0f2fe;
  color: #000000;  /* TEKS TETAP HITAM SAAT AKTIF */
  border-color: #38bdf8;
  font-weight: 700;
}
  </style>
</head>
<body class="no-select">
  <div class="container" id="app">
    <header>
      <h1>ASESMENT SUMATIF AKHIR SEMESTER</h1>
      <h1>SEKOLAH DASAR NEGERI YANTI</h1>
      <p class="subtitle">Tahun Ajaran 2025/2026 ‚Äî Mode Ujian Terkunci</p>
    </header>
    
    <div class="content">
      <div class="menu">
        <label style="width:220px">Nama Siswa:
          <input id="namaSiswa" type="text" placeholder="Masukkan nama lengkap" style="width:220px;margin-left:8px">
        </label>
        <label>Waktu (menit):
          <input id="setTime" type="number" value="30" min="1" max="180" style="width:80px;margin-left:8px">
        </label>
        <button onclick="startTest()" id="startBtn">üöÄ Mulai Tes</button>
        <button onclick="finishTest()" id="finishBtn">‚úÖ Selesai</button>
        <button onclick="exportJawaban()">üì§ Ekspor Jawaban</button>
      </div>
      
      <div id="quiz" class="card"></div>
      <div id="panel" class="card"></div>
      <div id="result" class="card" style="display:none"></div>
    </div>
  </div>

<script>
/* ================== STATE ================== */
const quizEl = document.getElementById('quiz');
const panelEl = document.getElementById('panel');
const resultEl = document.getElementById('result');

let questions = [];
let currentIndex = 0;
let answers = {};
let timer = null;
let timeLeft = 0;
let currentFileName = 'soal.json';

/* ================== LOAD SOAL ================== */
async function loadSoalJSON() {
  try {
    const res = await fetch('./soal.json');
    const data = await res.json();
    questions = Array.isArray(data.soal) ? data.soal : data;
    renderQuestion();
  } catch (e) {
    alert('‚ùå soal.json tidak bisa dimuat');
  }
}

/* ================== RENDER ================== */
function renderQuestion() {
  const q = questions[currentIndex];
  if (!q) return;

  let html = `<div class="q-text">${q.q}</div>`;

  // PILIHAN GANDA
  if (q.type === 'multiple_choice') {
    q.choices.forEach((c, i) => {
      const active = answers[q.id] === i ? 'active' : '';
      html += `
        <button class="answer-btn ${active}"
        onclick="answerPG(${q.id}, ${i})">${c}</button>
      `;
    });
  }

  // ISIAN
  if (q.type === 'fill_blank') {
    html += `
      <input type="text"
      value="${answers[q.id] || ''}"
      oninput="answerText(${q.id}, this.value)">
    `;
  }

  // ESAI
  if (q.type === 'essay') {
    html += `
      <textarea
      oninput="answerText(${q.id}, this.value)">${answers[q.id] || ''}</textarea>
    `;
  }

  quizEl.innerHTML = html;
}

/* ================== JAWABAN ================== */
function answerPG(id, val) {
  answers[id] = val;
  renderQuestion();
}

function answerText(id, val) {
  answers[id] = val;
}

/* ================== NAVIGASI ================== */
function goto(index) {
  if (index >= 0 && index < questions.length) {
    currentIndex = index;
    renderQuestion();
  }
}

/* ================== TIMER ================== */
function startTest() {
  const nama = document.getElementById('namaSiswa').value.trim();
  if (!nama) return alert('Isi nama dulu');

  const menit = parseInt(document.getElementById('setTime').value) || 30;
  timeLeft = menit * 60;

  clearInterval(timer);
  timer = setInterval(() => {
    timeLeft--;
    if (timeLeft <= 0) finishTest();
  }, 1000);

  alert('Ujian dimulai');
}

/* ================== SELESAI ================== */
function finishTest() {
  clearInterval(timer);

  quizEl.style.display = 'none';
  panelEl.style.display = 'none';
  resultEl.style.display = 'block';

  let total = 0;
  let max = 0;

  questions.forEach(q => {
    const score = q.score || 1;
    max += score;
    if (answers[q.id] === q.answer) total += score;
  });

  resultEl.innerHTML = `
    <h2>HASIL TES</h2>
    <p>Skor: ${total} / ${max}</p>
    <button onclick="exportJawaban()">Ekspor Jawaban</button>
    <button onclick="location.reload()">Ulangi</button>
  `;
}

/* ================== EXPORT ================== */
function exportJawaban() {
  const nama = document.getElementById('namaSiswa').value || 'Anonim';

  const data = {
    nama,
    tanggal: new Date().toISOString(),
    jawaban: answers,
    soal: questions
  };

  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);

  const a = document.createElement('a');
  a.href = url;
  a.download = `Jawaban_${nama.replace(/\s+/g,'_')}.json`;
  a.click();

  URL.revokeObjectURL(url);
}

/* ================== INIT ================== */
document.addEventListener('DOMContentLoaded', loadSoalJSON);
</script>
</body>
</html>
