<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ASESMENT SUMATIF AKHIR SEMESTER ‚Äî SD NEGERI YANTI</title>
<style>
* { box-sizing: border-box; margin:0; padding:0; font-family:'Segoe UI', Tahoma, Arial, sans-serif; }
body { background: linear-gradient(135deg,#1e3c72 0%,#2a5298 100%); color:#333; padding:20px; min-height:100vh; }
.container { max-width:1200px; margin:0 auto; background:white; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,.2); overflow:hidden; }
header { background: linear-gradient(135deg,#2d2d30 0%,#4a4a4f 100%); padding:20px; border-bottom:3px solid #0e639c; text-align:center; color:white; }
h1 { color:#fff; font-size:28px; margin-bottom:4px; }
.subtitle { color:#ccc; font-size:14px; font-weight:300; }
.content { padding:22px; }
.menu { display:flex; flex-wrap:wrap; gap:12px; margin-bottom:10px; padding:18px; background:#f8f9fa; border-radius:8px; border:2px solid #e9ecef; align-items:center; }
input[type=text],input[type=number],textarea { padding:8px; border-radius:6px; border:2px solid #ced4da; width:100%; font-size:14px; }
button { background:#0e639c; color:#fff; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; font-weight:700; }
.card { background:white; border-radius:10px; padding:18px; box-shadow:0 4px 15px rgba(0,0,0,.08); margin-bottom:15px; border:2px solid #e9ecef; }
.answer-btn { display:block; width:100%; margin:8px 0; padding:12px; text-align:left; background:#fff; color:#000; border:2px solid #cbd5e1; border-radius:8px; cursor:pointer; font-size:16px; }
.answer-btn:hover { background:#f1f5f9; color:#000; }
.answer-btn.active { background:#e0f2fe; color:#000; border-color:#38bdf8; font-weight:700; }
.score-display { font-size:22px; font-weight:700; text-align:center; padding:12px; margin:12px 0; border-radius:8px; background:linear-gradient(135deg,#22c55e,#16a34a); color:#fff; }
</style>
</head>
<body>
<div class="container">
<header>
<h1>ASESMENT SUMATIF AKHIR SEMESTER</h1>
<h1>SD NEGERI YANTI</h1>
<p class="subtitle">Tahun Ajaran 2025/2026 ‚Äî Mode Ujian Terkunci</p>
</header>

<div class="content">
<div class="menu">
<label style="width:220px">Nama Siswa:
<input id="namaSiswa" type="text" placeholder="Masukkan nama lengkap" style="width:220px;margin-left:8px">
</label>
<label>Waktu (menit):
<input id="setTime" type="number" value="30" min="1" max="180" style="width:80px;margin-left:8px">
</label>
<button onclick="startTest()" id="startBtn">üöÄ Mulai Tes</button>
<button onclick="finishTest()" id="finishBtn">‚úÖ Selesai</button>
<button onclick="exportJawaban()">üì§ Ekspor Jawaban</button>
</div>

<div id="quiz" class="card"></div>
<div id="panel" class="card"></div>
<div id="result" class="card" style="display:none"></div>
</div>
</div>

<script>
let questions = [], current=0, answers={}, marked={}, timer=null, timeLeft=0, started=false, currentFileName='soal.json';
const quizEl=document.getElementById('quiz');
const panelEl=document.getElementById('panel');
const resultEl=document.getElementById('result');

async function loadSoalJSON(){
  try{
    const res=await fetch('./soal.json');
    const data=await res.json();
    questions=Array.isArray(data.soal)?data.soal:data;
    renderQuestion();
    renderPanel();
  } catch(e){
    alert('‚ùå soal.json tidak bisa dimuat');
  }
}

function renderQuestion(){
  const q=questions[current];
  if(!q) return;
  let html=`<div class="q-text">${q.q}</div>`;
  if(q.type==='multiple_choice'){
    q.choices.forEach((c,i)=>{
      const active=answers[q.id]===i?'active':'';
      html+=`<button class="answer-btn ${active}" onclick="answerPG(${q.id},${i})">${c}</button>`;
    });
  } else if(q.type==='fill_blank'){
    html+=`<input type="text" value="${answers[q.id]||''}" oninput="answerText(${q.id},this.value)">`;
  } else if(q.type==='essay'){
    html+=`<textarea oninput="answerText(${q.id},this.value)">${answers[q.id]||''}</textarea>`;
  }
  quizEl.innerHTML=html;
}

function answerPG(id,val){ answers[id]=val; renderQuestion(); renderPanel(); }
function answerText(id,val){ answers[id]=val; renderPanel(); }

function renderPanel(){
  let html='';
  questions.forEach((q,i)=>{
    const cls=answers[q.id]!==undefined?'answered':'';
    html+=`<button class="answer-btn ${cls}" onclick="goto(${i})">${i+1}</button>`;
  });
  panelEl.innerHTML=html;
}

function goto(i){ if(i>=0 && i<questions.length){ current=i; renderQuestion(); } }

function startTest(){
  const nama=document.getElementById('namaSiswa').value.trim();
  if(!nama) return alert('Isi nama dulu');
  const menit=parseInt(document.getElementById('setTime').value)||30;
  timeLeft=menit*60; started=true;
  clearInterval(timer);
  timer=setInterval(()=>{
    timeLeft--; if(timeLeft<=0) finishTest();
  },1000);
  alert(`Ujian dimulai! Nama: ${nama}, Waktu: ${menit} menit`);
}

function finishTest(){
  clearInterval(timer); started=false;
  quizEl.style.display='none'; panelEl.style.display='none'; resultEl.style.display='block';
  let total=0,max=0,correctCount=0;
  questions.forEach((q,index)=>{
    const score=q.score||1; max+=score;
    const sc=(answers[q.id]===q.answer)?score:0;
    total+=sc; if(sc>0) correctCount++;
  });
  const percent=max>0?Math.round((total/max)*100):0;
  const status=percent>=70?"LULUS üéâ":"TIDAK LULUS üí™";
  let detailHtml='';
  questions.forEach((q,index)=>{
    const a=answers[q.id]; const sc=(a===q.answer)?(q.score||1):0; const maxScore=q.score||1;
    let ansText='';
    if(q.type==='multiple_choice'){ ansText=a!==undefined?`${String.fromCharCode(65+a)}. ${q.choices[a]}`:'Belum dijawab';
    } else if(q.type==='fill_blank'){ ansText=a||'Belum dijawab';
    } else if(q.type==='essay'){ ansText=a?a.substring(0,100)+'...':'Belum dijawab'; }
    const correctAnswer=q.type==='multiple_choice'?`${String.fromCharCode(65+q.answer)}. ${q.choices[q.answer]}`:q.answer;
    detailHtml+=`<div style="margin-bottom:15px;padding:15px;border:1px solid #e5e7eb;border-radius:8px;background:${sc>0?'#f0fdf4':'#fef2f2'}">
      <strong>Soal ${index+1}:</strong> ${q.q}<br>
      <strong>Jawaban Anda:</strong> ${ansText}<br>
      <strong>Jawaban Benar:</strong> ${correctAnswer}<br>
      <strong>Skor:</strong> ${sc}/${maxScore}
    </div>`;
  });
  resultEl.innerHTML=`<h2 style="text-align:center;color:#0e639c;">üìä HASIL TES</h2>
    <div class="score-display">${total} / ${max} (${percent}%) ‚Äî ${status}</div>
    <div style="background:#f8fafc;padding:15px;border-radius:8px;margin:15px 0;">
      <p><strong>üë§ Nama Siswa:</strong> ${document.getElementById('namaSiswa').value}</p>
      <p><strong>üìÖ Tanggal:</strong> ${new Date().toLocaleString('id-ID')}</p>
      <p><strong>üìÇ Paket Soal:</strong> ${currentFileName}</p>
      <p><strong>‚úÖ Soal Terjawab:</strong> ${correctCount} dari ${questions.length}</p>
    </div>
    <h3>üìù Detail Jawaban</h3>
    <div style="max-height:400px;overflow-y:auto;margin:15px 0;">${detailHtml}</div>
    <div style="text-align:center;margin-top:20px;">
      <button onclick="exportJawaban()" style="padding:12px 24px;background:#059669;margin:5px;">üì• Ekspor Jawaban</button>
      <button onclick="location.reload()" style="padding:12px 24px;background:#0e639c;margin:5px;">üîÑ Tes Baru</button>
    </div>`;
}

function exportJawaban(){
  const nama=document.getElementById('namaSiswa').value.trim()||'Anonim';
  const data={ nama, tanggal:new Date().toISOString(), jawaban:answers, soal:questions };
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url;
  a.download=`Jawaban_${nama.replace(/\s+/g,'_')}.json`; a.click();
  URL.revokeObjectURL(url);
}

document.addEventListener('DOMContentLoaded', loadSoalJSON);
</script>
</body>
</html>
