<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ASAS SD NEGERI YANTI</title>

<style>
*{box-sizing:border-box;font-family:Segoe UI,Tahoma,Arial}
body{margin:0;background:#1e3c72;padding:20px}
.container{max-width:1100px;margin:auto;background:#fff;border-radius:12px;overflow:hidden}
header{background:#2d2d30;color:#fff;text-align:center;padding:20px}
.content{padding:20px}
.menu{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:15px}
input,textarea{padding:8px;border:2px solid #ccc;border-radius:6px}
button{padding:8px 12px;border:none;border-radius:6px;background:#0e639c;color:#fff;font-weight:700;cursor:pointer}
.card{border:2px solid #eee;border-radius:8px;padding:15px;margin-bottom:15px}
.answer-btn{width:100%;text-align:left;padding:12px;margin:6px 0;border:2px solid #cbd5e1;border-radius:8px;background:#fff;font-size:15px}
.answer-btn.active{background:#e0f2fe;border-color:#38bdf8;font-weight:700}
.panel button{width:42px;height:42px;margin:4px;border-radius:6px;border:2px solid #ccc;background:#fff}
.panel button.answered{background:#dcfce7;border-color:#22c55e}
.panel button.current{border-color:#2563eb}
.timer{font-weight:700;color:#dc2626;text-align:center;margin-bottom:10px}
</style>
</head>

<body>
<div class="container">
<header>
<h2>ASESMEN SUMATIF AKHIR SEMESTER</h2>
<p>SD NEGERI YANTI</p>
</header>

<div class="content">

<div class="menu">
<input id="nama" placeholder="Nama Siswa">
<input id="durasi" type="number" value="30" min="1" style="width:80px">
<button onclick="start()">Mulai</button>
<button onclick="finish()">Selesai</button>
<button onclick="exportData()">Ekspor</button>
</div>

<div class="timer" id="timer"></div>

<div class="card" id="quiz"></div>
<div class="card panel" id="panel"></div>
<div class="card" id="result" style="display:none"></div>

</div>
</div>

<script>
let soal=[],jawaban={},idx=0,waktu=0,timerInt=null;

async function loadSoal(){
  const r=await fetch('./soal.json');
  const d=await r.json();
  soal=d.soal||d;
  renderPanel();
  renderSoal();
}

function renderSoal(){
  const q=soal[idx];
  if(!q)return;
  let h=`<h3>${idx+1}. ${q.q}</h3>`;
  if(q.type==="multiple_choice"){
    q.choices.forEach((c,i)=>{
      const a=jawaban[q.id]===i?"active":"";
      h+=`<button class="answer-btn ${a}" onclick="jawabPG(${q.id},${i})">${c}</button>`;
    });
  }
  if(q.type==="fill_blank"){
    h+=`<input value="${jawaban[q.id]||""}" oninput="jawabText(${q.id},this.value)">`;
  }
  if(q.type==="essay"){
    h+=`<textarea rows="5" oninput="jawabText(${q.id},this.value)">${jawaban[q.id]||""}</textarea>`;
  }
  document.getElementById("quiz").innerHTML=h;
  updatePanel();
}

function renderPanel(){
  const p=document.getElementById("panel");
  p.innerHTML="";
  soal.forEach((_,i)=>{
    const b=document.createElement("button");
    b.textContent=i+1;
    b.onclick=()=>{idx=i;renderSoal()};
    p.appendChild(b);
  });
}

function updatePanel(){
  [...panel.children].forEach((b,i)=>{
    b.className="";
    if(i===idx)b.classList.add("current");
    if(jawaban[soal[i].id]!==undefined)b.classList.add("answered");
  });
}

function jawabPG(id,v){jawaban[id]=v;renderSoal()}
function jawabText(id,v){jawaban[id]=v;updatePanel()}

function start(){
  const n=document.getElementById("nama").value.trim();
  if(!n)return alert("Nama wajib");
  waktu=(+durasi.value||30)*60;
  timerInt=setInterval(()=>{
    waktu--;
    timer.textContent=`Sisa waktu: ${Math.floor(waktu/60)}:${String(waktu%60).padStart(2,"0")}`;
    if(waktu<=0)finish();
  },1000);
}

function finish(){
  clearInterval(timerInt);
  quiz.style.display=panel.style.display="none";
  result.style.display="block";
  let benar=0;
  soal.forEach(q=>{if(jawaban[q.id]===q.answer)benar++});
  result.innerHTML=`<h3>SELESAI</h3><p>Benar: ${benar}/${soal.length}</p>`;
}

function exportData(){
  const data={nama:nama.value,tanggal:new Date().toISOString(),jawaban,soal};
  const b=new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(b);
  a.download="jawaban.json";
  a.click();
}

document.addEventListener("DOMContentLoaded",loadSoal);
</script>
</body>
</html>
